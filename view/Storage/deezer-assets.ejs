<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js"></script>

<script type="text/javascript" src="https://cdns-files.dzcdn.net/js/min/dz-v00401308.js" defer="true"></script>

<style type="text/css">
    .progressbarplay {
        cursor: pointer;
        overflow: hidden;
        height: 8px;
        margin-bottom: 8px;
        background-color: #F7F7F7;
        background-image: -moz-linear-gradient(top, whiteSmoke, #F9F9F9);
        background-image: -ms-linear-gradient(top, whiteSmoke, #F9F9F9);
        background-image: -webkit-gradient(linear, 0 0, 0 100%, from(whiteSmoke), to(#F9F9F9));
        background-image: -webkit-linear-gradient(top, whiteSmoke, #F9F9F9);
        background-image: -o-linear-gradient(top, whiteSmoke, #F9F9F9);
        background-image: linear-gradient(top, whiteSmoke, #F9F9F9);
        background-repeat: repeat-x;
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#f5f5f5', endColorstr='#f9f9f9', GradientType=0);
        -webkit-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        -moz-box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
        -webkit-border-radius: 6px;
        -moz-border-radius: 6px;
        border-radius: 6px;
    }

    .progressbarplay .bar {
        cursor: pointer;
        background: #4496C6;
        width: 0;
        height: 8px;
        color: white;
        font-size: 12px;
        text-align: center;
        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
        -webkit-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
        -moz-box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
        box-shadow: inset 0 -1px 0 rgba(0, 0, 0, 0.15);
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        -webkit-transition: width .6s ease;
        -moz-transition: width .6s ease;
        -ms-transition: width .6s ease;
        -o-transition: width .6s ease;
        transition: width .6s ease;
    }
</style>

<div id="dz-root"></div>
<div id="player" style="width:100%;" align="center"></div>
<br />
<div id="controlers" style="display: none;">

    <br />
    <h3>Music Controls</h3>
    <input class="btn btn-secondary" type="button" onclick="DZ.player.prev(); return false;" value="Prev" />
    <input class="btn btn-secondary" type="button" onclick="DZ.player.pause(); return false;" value="Pause" />
    <input class="btn btn-secondary" type="button" onclick="DZ.player.play(); return false;" value="Play" />
    <input class="btn btn-secondary" type="button" onclick="DZ.player.next(); return false;" value="Next" />
    <br />
    <h3>Volume Controls</h3>
    <input class="btn btn-secondary" type="button" onclick="DZ.player.setMute(); return false;" value="Set Mute" />
    <input class="btn btn-secondary" type="button" onclick="DZ.player.setVolume(20); return false;"
        value="Set Volume 20" />
    <input class="btn btn-secondary" type="button" onclick="DZ.player.setVolume(80); return false;"
        value="Set Volume 80" />

    <input class="btn btn-secondary" type="button" onclick="DZ.player.playTracks([3135556], false); return false;"
        value="Play track" />

    <br /><br /><br />
</div>
<div id="slider_seek" class="progressbarplay">
    <div class="bar" style="width: 0%;"></div>
</div>
<script>
    $(document).ready(function () {
        $("#controlers input").attr('disabled', true);
        $("#slider_seek").click(function (evt, arg) {
            var left = evt.offsetX;
            DZ.player.seek((evt.offsetX / $(this).width()) * 100);
        });
    });

    function event_listener_append() {
        var pre = document.getElementById('event_listener');
        var line = [];
        for (var i = 0; i < arguments.length; i++) {
            line.push(arguments[i]);
        }
        pre.innerHTML += line.join(' ') + "\n";
    }

    function onPlayerLoaded() {
        $("#controlers input").attr('disabled', false);
        event_listener_append('player_loaded');
        DZ.Event.subscribe('current_track', function (arg) {
            event_listener_append('current_track', arg.index, arg.track.title, arg.track.album.title);
            //console.log("Track Information", arg);

            /*const pId = document.getElementById("playlist-id").value;

            socket.emit("broadcast track", {
                trackId: arg.track.id,
                pId: pId
            });*/
        });
        DZ.Event.subscribe('player_position', function (arg) {
            event_listener_append('position', arg[0], arg[1]);
            $("#slider_seek").find('.bar').css('width', (100 * arg[0] / arg[1]) + '%');
        });

        /*const pId = document.getElementById("playlist-id").value;
        alert(pId);
        DZ.player.playPlaylist(pId);*/
    }
    document.addEventListener('DOMContentLoaded', function () {
        DZ.init({
            appId: '437522',
            channelUrl: 'http://localhost:5000/playlist-header',
            player: {
                container: 'player',
                muted: false,
                volume: 100,
                playlist: true,
                width: 650,
                height: 300,
                onload: onPlayerLoaded
            }
        });
    });

    setTimeout(function () {
        const pId = document.getElementById("playlist-id").value;
        DZ.player.playPlaylist(Number(pId));
        return false
    }, 3000);

    socket.on("broadcast track", (data) => {
        alert("Someone added a track to a player");
    });

    socket.on("broadcast track success", (data) => {
        alert("Success message");
    });
</script><br />
<div style="display: none;">
    event_listener : <br />
    <pre  style="display: none !important; opacity: 0;" id="event_listener" style="height:100px;overflow:auto;"></pre>
</div>